<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Guerra: A Titanomaquia</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Metamorphous&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        obsidian: '#1a1a1a',
                        bedrock: '#0a0a0a',
                        gold: '#FFD700',
                        golddim: '#B8860B',
                        mythicred: '#8B0000',
                        mythicblue: '#191970',
                        diamond: '#b9f2ff',
                        emerald: '#50c878',
                        chocolate: '#D2691E'
                    },
                    fontFamily: {
                        heading: ['Cinzel', 'serif'],
                        subheading: ['Metamorphous', 'serif'],
                        body: ['Open Sans', 'sans-serif'],
                    },
                    backgroundImage: {
                        'Greek-pattern': "url('https://www.transparenttextures.com/patterns/black-scales.png')",
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'shine': 'shine 1s linear infinite',
                        'float-up': 'floatUp 15s linear forwards',
                    },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        floatUp: {
                            '0%': { bottom: '-10%', opacity: '0', transform: 'scale(0.5)' },
                            '10%': { opacity: '0.6' },
                            '90%': { opacity: '0.6' },
                            '100%': { bottom: '110%', opacity: '0', transform: 'scale(1)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        ::-webkit-scrollbar-thumb { background: #B8860B; border-radius: 5px; }
        
        .gold-glow-text { text-shadow: 0 0 15px rgba(255, 215, 0, 0.6); }

        .input-mythic {
            background-color: rgba(0, 0, 0, 0.4);
            border: 1px solid #444;
            color: #e5e7eb;
            padding: 0.75rem;
            width: 100%;
            border-radius: 0.375rem;
            transition: all 0.3s;
            font-family: 'Open Sans', sans-serif;
        }
        .input-mythic:focus { border-color: #FFD700; outline: none; box-shadow: 0 0 10px rgba(255, 215, 0, 0.2); }
        .input-mythic.error { border-color: #ef4444; box-shadow: 0 0 10px rgba(239, 68, 68, 0.2); }
        select.input-mythic option { background-color: #1a1a1a; color: #e5e7eb; }
        
        /* Glass Picker */
        .glass-picker-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-top: 8px; }
        .glass-option { aspect-ratio: 1; cursor: pointer; border: 2px solid rgba(255, 255, 255, 0.1); position: relative; transition: transform 0.1s, border-color 0.1s; background-image: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 20%, rgba(255,255,255,0) 80%, rgba(255,255,255,0.1) 100%); }
        .glass-option:hover { transform: scale(1.1); z-index: 10; border-color: rgba(255, 255, 255, 0.5); }
        .glass-option.selected { border: 3px solid #FFD700; box-shadow: 0 0 10px #FFD700; transform: scale(1.1); z-index: 10; }
        .glass-option.disabled { opacity: 0.3; cursor: not-allowed; filter: grayscale(100%); transform: none; border-color: #444; }
        
        /* Cards e Efeitos */
        .pantheom-card { transition: all 0.4s ease; }
        .pantheom-card:hover { transform: translateY(-10px) scale(1.02); }
        .leader-img-container { mask-image: linear-gradient(to bottom, black 80%, transparent 100%); -webkit-mask-image: linear-gradient(to bottom, black 80%, transparent 100%); }
        
        #floating-names-container { position: absolute; inset: 0; pointer-events: none; z-index: 5; overflow: hidden; }
        .floating-name { position: absolute; color: rgba(255, 215, 0, 0.3); font-family: 'Cinzel', serif; font-weight: bold; text-transform: uppercase; text-shadow: 0 0 5px rgba(0,0,0,0.8); white-space: nowrap; }
        
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.5), 0 0 15px rgba(184, 134, 11, 0.3); }
        .farm-taken { opacity: 0.5; cursor: not-allowed !important; filter: grayscale(80%); }
        .fade-in-section { opacity: 0; transform: translateY(20px); transition: opacity 0.8s ease-out, transform 0.8s ease-out; }
        .fade-in-section.is-visible { opacity: 1; transform: none; }
    </style>
</head>
<body class="bg-bedrock text-gray-200 font-body overflow-x-hidden selection:bg-gold selection:text-black">

    <nav class="fixed top-0 w-full z-40 bg-obsidian/90 backdrop-blur-md border-b border-golddim/30">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span class="material-symbols-outlined text-gold">swords</span>
                <span class="font-heading font-bold text-xl text-gold gold-glow-text">A Batalha dos 100</span>
            </div>
            <div class="hidden md:flex gap-6 text-sm font-semibold tracking-widest text-gray-400">
                <a href="#introducao" class="hover:text-gold transition-colors">GUIA</a>
                <a href="#ciclo" class="hover:text-gold transition-colors">HOR√ÅRIOS</a>
                <a href="#pantheom" class="hover:text-gold transition-colors text-gold">L√çDERES</a>
                <a href="#clas" class="hover:text-gold transition-colors">CL√ÉS</a>
                <a href="#economia" class="hover:text-gold transition-colors">ECONOMIA</a>
                <a href="#registro" class="hover:text-gold transition-colors">REGISTRO</a>
                <a href="#saga" class="hover:text-gold transition-colors">SAGA</a>
                <a href="#tesouro" class="text-gold hover:text-white transition-colors border border-gold/30 px-2 py-1 rounded bg-gold/10">TESOURO</a>
            </div>
        </div>
    </nav>

    <header class="relative h-screen flex items-center justify-center overflow-hidden bg-obsidian">
        <div id="floating-names-container"></div>
        <div class="absolute inset-0 z-0">
            <img src="img/atenas.jpg" alt="Background" class="w-full h-full object-cover opacity-50 grayscale brightness-75">
            <div class="absolute inset-0 bg-gradient-to-b from-transparent via-bedrock/60 to-bedrock"></div>
        </div>
        
        <div class="relative z-10 text-center px-4 max-w-4xl fade-in-section">
            <div class="mb-4 inline-block px-4 py-1 border border-gold/50 rounded-full bg-black/50 backdrop-blur-sm">
                <span class="text-gold text-xs font-bold tracking-[0.3em] uppercase">Saga: A Titanomaquia</span>
            </div>
            <h1 class="text-5xl md:text-7xl font-heading font-black text-white mb-6 leading-tight drop-shadow-2xl">
                MINECRAFT <span class="text-transparent bg-clip-text bg-gradient-to-r from-gold to-yellow-200">GUERRA</span>
            </h1>
            <p class="text-lg md:text-2xl font-subheading text-gray-300 italic mb-8 max-w-2xl mx-auto border-l-4 border-gold pl-6 text-left">
                "Tebas olha para baixo, entediado com a paz. Ele exige gl√≥ria. Ele exige sangue. Ele exige um Campe√£o."
            </p>

            <div class="mb-12 flex flex-col items-center gap-8">
                <div class="text-center p-6 bg-black/40 rounded-xl border border-gold/30 backdrop-blur-md shadow-[0_0_30px_rgba(255,215,0,0.1)] hover:scale-105 transition-transform duration-500 cursor-default">
                    <p class="text-gold text-sm uppercase tracking-[0.2em] mb-2 font-bold flex items-center justify-center gap-2">
                        <span class="material-symbols-outlined text-sm animate-pulse">history_edu</span> Era da Guerra
                    </p>
                    <div class="flex items-baseline justify-center gap-3">
                        <span class="font-heading font-black text-4xl text-stone-500 mr-2">DIA</span>
                        <span id="server-days" class="font-heading font-black text-7xl text-white drop-shadow-[0_0_20px_rgba(255,215,0,0.6)]">0</span>
                    </div>
                    <p class="text-[10px] text-gray-500 uppercase tracking-widest mt-2">Desde 15 Dez 2025</p>
                </div>
                <div class="flex items-center gap-3 bg-obsidian/80 border border-stone-700 px-6 py-2 rounded-full hover:border-gold/50 transition-all cursor-default">
                    <span class="material-symbols-outlined text-gold text-sm">groups</span>
                    <span class="text-xs font-bold uppercase tracking-widest text-gray-400">Guerreiros Convocados:</span>
                    <span id="participant-count" class="text-lg font-heading font-bold text-white">0</span>
                </div>
            </div>

            <div class="block">
                <a href="#introducao" class="group relative inline-flex items-center gap-2 px-6 py-3 bg-transparent border border-stone-600 text-gray-400 font-bold uppercase tracking-widest text-xs hover:bg-white/5 hover:text-white hover:border-white transition-all duration-300">
                    Ler os Decretos
                    <span class="material-symbols-outlined group-hover:translate-x-1 transition-transform text-sm">arrow_downward</span>
                </a>
            </div>
        </div>
    </header>

    <div id="join-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" onclick="closeJoinModal()"></div>
        <div class="relative bg-stone-900 border-2 border-gold p-8 rounded-lg max-w-md w-full shadow-[0_0_50px_rgba(255,215,0,0.2)] animate-[pulse_0.2s_ease-out]">
            <button onclick="closeJoinModal()" class="absolute top-4 right-4 text-gray-500 hover:text-white"><span class="material-symbols-outlined">close</span></button>
            <div class="text-center mb-6">
                <span class="material-symbols-outlined text-5xl text-gold mb-2">person_add</span>
                <h3 class="text-2xl font-heading text-white">Convoca√ß√£o</h3>
                <p class="text-gray-400 text-xs uppercase tracking-widest">Inscreva seu nome na hist√≥ria</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-400 text-xs font-bold mb-1 uppercase">Nome (Opcional):</label>
                    <input type="text" id="player-realname" class="input-mythic" placeholder="Seu nome">
                </div>
                <div>
                    <label class="block text-gold text-xs font-bold mb-1 uppercase">Nickname (No Jogo):</label>
                    <input type="text" id="player-nickname" class="input-mythic border-gold/50 focus:border-gold" placeholder="Ex: SteveGamer" required>
                </div>
                <button id="btn-confirm-join" onclick="confirmParticipation()" class="w-full py-3 bg-gold hover:bg-yellow-400 text-black font-bold uppercase tracking-widest transition-colors mt-2">Confirmar Presen√ßa</button>
            </div>
        </div>
    </div>

    <section id="introducao" class="py-24 bg-obsidian border-b border-stone-800 fade-in-section relative overflow-hidden">
        <div class="max-w-5xl mx-auto px-4 relative z-10 text-center">
             <h2 class="text-4xl font-heading text-white mb-4">A Cr√¥nica do Mundo</h2>
             <p class="text-gray-300">Bem-vindo ao palco da hist√≥ria.</p>
             </div>
    </section>

    <section id="ciclo" class="py-24 bg-stone-900 border-b border-stone-800 fade-in-section">
        <div class="max-w-5xl mx-auto px-4 text-center">
             <h2 class="text-5xl font-heading text-white mb-10 gold-glow-text">I. O Ciclo do Sol</h2>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                 <div class="bg-black/60 border-2 border-emerald-900 p-8 rounded-xl"><h3 class="text-white">Segunda a Sexta</h3><p class="text-4xl text-white">18:00 - 00:00</p></div>
                 <div class="bg-black/60 border-2 border-red-900 p-8 rounded-xl"><h3 class="text-white">Finais de Semana</h3><p class="text-4xl text-white">14:00 - 00:00</p></div>
             </div>
         </div>
    </section>

    <section id="pantheom" class="py-24 bg-stone-900 border-b border-stone-800 fade-in-section relative">
        <div class="max-w-7xl mx-auto px-4 relative z-10">
            <div class="text-center mb-16">
                <h2 class="text-4xl font-heading text-white mb-4">Pantheom dos L√≠deres</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div class="pantheom-card bg-obsidian border-2 border-red-600 rounded-lg p-4 text-center">
                    <img src="img/trojan.png" class="h-48 mx-auto object-contain">
                    <h3 class="text-white text-xl font-bold mt-2">Omega</h3>
                </div>
                <div class="pantheom-card bg-obsidian border-2 border-stone-600 rounded-lg p-4 text-center">
                    <img src="img/tiolk.png" class="h-48 mx-auto object-contain">
                    <h3 class="text-white text-xl font-bold mt-2">LK</h3>
                </div>
                <div class="pantheom-card bg-obsidian border-2 border-pink-500 rounded-lg p-4 text-center">
                    <img src="img/soupyer.png" class="h-48 mx-auto object-contain">
                    <h3 class="text-white text-xl font-bold mt-2">Soupyer</h3>
                </div>
                <div class="pantheom-card bg-obsidian border-2 border-blue-600 rounded-lg p-4 text-center">
                    <img src="img/mattkk.png" class="h-48 mx-auto object-contain">
                    <h3 class="text-white text-xl font-bold mt-2">Mattkk</h3>
                </div>
            </div>
        </div>
    </section>

    <section id="clas" class="py-20 px-4 relative bg-Greek-pattern fade-in-section">
        <div class="max-w-6xl mx-auto text-center">
            <h2 class="text-4xl font-heading text-white mb-4">II. A Estrutura dos Cl√£s</h2>
            <p class="text-gray-400">Regidos por 4 Cristais Primordiais.</p>
        </div>
    </section>

    <section id="economia" class="py-20 bg-stone-900 border-y border-stone-800 fade-in-section">
        <div class="max-w-7xl mx-auto px-4">
            <div class="text-center mb-8">
                <h2 class="text-4xl font-heading text-white">IV. A Lei da Escassez</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8" id="economy-grid"></div>
            <div id="economy-msg" class="text-center mt-8 font-heading text-xl text-gold opacity-0 transition-opacity min-h-[2rem]"></div>
        </div>
    </section>

    <section id="registro" class="py-20 bg-stone-900 border-b border-stone-800 relative fade-in-section">
        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/black-scales.png')] opacity-20"></div>
        <div class="max-w-7xl mx-auto px-4 relative z-10">
            <div class="text-center mb-16">
                <span class="material-symbols-outlined text-6xl text-gold mb-4">edit_document</span>
                <h2 class="text-4xl font-heading text-white mb-4">Registro de Guerra</h2>
                <div class="h-1 w-24 bg-gold mx-auto"></div>
                <p class="mt-4 text-gray-400">Inscreva seu Cl√£ no livro da hist√≥ria. Apenas L√≠deres.</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                <div class="bg-obsidian border-2 border-gold/50 p-8 rounded-lg shadow-[0_0_20px_rgba(0,0,0,0.5)] relative">
                    <h3 class="text-2xl font-heading text-gold mb-6 flex items-center gap-2">
                        <span class="material-symbols-outlined">swords</span> Novo Registro
                    </h3>
                    <p class="text-xs text-gray-500 mb-6 italic">* Apenas o L√≠der deve preencher este formul√°rio.</p>
                    
                    <form id="clan-form" class="space-y-6" onsubmit="event.preventDefault(); registerClan();">
                        <div>
                            <label class="block text-gray-400 text-sm font-bold mb-2 uppercase tracking-wider">Estandarte do Cl√£ (Imagem):</label>
                            <div class="relative border border-stone-600 rounded bg-black/40 p-4 text-center cursor-pointer hover:border-gold transition-colors group">
                                <input type="file" id="clan-banner-file" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" onchange="previewBanner(event)">
                                <div id="banner-preview-area" class="flex flex-col items-center justify-center">
                                    <span class="material-symbols-outlined text-3xl text-stone-500 mb-2 group-hover:text-gold">image</span>
                                    <p class="text-xs text-gray-400 group-hover:text-white">Clique para enviar (Max 2MB)</p>
                                </div>
                                <img id="banner-preview-img" class="hidden w-full h-32 object-cover rounded mt-2 border border-gold/30">
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-400 text-sm font-bold mb-2 uppercase tracking-wider">Nome do Cl√£:</label>
                            <input type="text" id="clan-name" class="input-mythic" placeholder="Ex: Os Spartanos" required>
                        </div>

                        <div>
                            <label class="block text-gray-400 text-sm font-bold mb-2 uppercase tracking-wider">Lema do Cl√£:</label>
                            <input type="text" id="clan-motto" class="input-mythic" placeholder="Ex: For√ßa e Honra" maxlength="60">
                        </div>

                        <div>
                            <label class="block text-gray-400 text-sm font-bold mb-2 uppercase tracking-wider">Tema do Cl√£:</label>
                            <select id="clan-theme" class="input-mythic cursor-pointer" onchange="updateThemeInfo()">
                                <option value="" disabled selected>Escolha sua Hierarquia...</option>
                                </select>
                            <div id="theme-info" class="mt-2 p-3 bg-black/40 rounded border border-stone-700 text-sm hidden transition-all">
                                <p id="theme-desc" class="text-gray-300 italic mb-2"></p>
                                <div class="grid grid-cols-3 gap-2 text-xs text-center">
                                    <div class="bg-stone-800 p-1 rounded"><span class="text-gold block mb-1">L√≠der</span><span id="theme-leader-title" class="font-bold text-white"></span></div>
                                    <div class="bg-stone-800 p-1 rounded"><span class="text-gray-400 block mb-1">Co-L√≠der</span><span id="theme-coleader-title" class="font-bold text-white"></span></div>
                                    <div class="bg-stone-800 p-1 rounded"><span class="text-gray-500 block mb-1">Membros</span><span id="theme-member-title" class="font-bold text-white"></span></div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-400 text-sm font-bold mb-2 uppercase tracking-wider">Cor da Equipe:</label>
                            <input type="hidden" id="clan-color" value="#FFFFFF">
                            <div class="glass-picker-grid" id="glass-picker">
                                </div>
                            <div class="mt-4 flex items-center justify-between">
                                <span class="text-xs text-gray-500" id="selected-color-name">Selecionado: Branco</span>
                                <button type="button" onclick="copyColorCode()" class="px-4 py-2 bg-stone-800 border border-gold/30 text-gold rounded hover:bg-stone-700 transition-colors text-xs font-bold flex items-center gap-2 group relative">
                                    <span class="material-symbols-outlined text-sm">content_copy</span>
                                    Copiar C√≥digo
                                    <span id="copy-feedback" class="absolute -top-8 left-1/2 -translate-x-1/2 bg-emerald-500 text-white text-xs px-2 py-1 rounded opacity-0 transition-opacity">Copiado!</span>
                                </button>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-400 text-sm font-bold mb-2 uppercase tracking-wider" id="label-leader">L√≠der (Nick):</label>
                                <input type="text" id="clan-leader" class="input-mythic" placeholder="Ex: SteveGamer" required>
                            </div>
                            <div>
                                <label class="block text-gray-400 text-sm font-bold mb-2 uppercase tracking-wider" id="label-coleader">Co-L√≠der (Nick):</label>
                                <input type="text" id="clan-coleader" class="input-mythic" placeholder="Ex: AlexPro">
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-400 text-sm font-bold mb-2 uppercase tracking-wider" id="label-members">Membros (Nicks):</label>
                            <textarea id="clan-members" class="input-mythic h-24 resize-none" placeholder="Ex: Herobrine, Notch... (Separe por v√≠rgula)" required></textarea>
                            <p id="member-count-feedback" class="text-xs text-gray-500 mt-1 text-right">0/6 Membros</p>
                        </div>

                        <div>
                            <label class="block text-gold text-sm font-bold mb-2 uppercase tracking-wider flex items-center gap-2">
                                <span class="material-symbols-outlined text-base">balance</span> Escolha da Economia:
                            </label>
                            <input type="text" id="clan-economy-input" class="input-mythic bg-stone-800 border-gold/30 text-gold cursor-not-allowed" placeholder="Clique em uma Farm na se√ß√£o Economia acima" readonly required>
                            <input type="hidden" id="clan-economy-type">
                            <p class="text-xs text-gray-500 mt-1">* Selecione uma op√ß√£o dispon√≠vel na se√ß√£o 'Lei da Escassez' acima.</p>
                        </div>

                        <button type="submit" id="register-btn" class="w-full py-4 bg-gradient-to-r from-gold to-yellow-600 text-black font-heading font-bold text-xl uppercase tracking-widest hover:brightness-110 transition-all shadow-lg transform hover:-translate-y-1 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:translate-y-0">
                            Registrar Cl√£
                        </button>
                    </form>
                    
                    <div id="limit-reached-msg" class="absolute inset-0 bg-obsidian/90 backdrop-blur-sm flex items-center justify-center text-center p-8 hidden">
                        <div>
                            <span class="material-symbols-outlined text-6xl text-red-500 mb-4">block</span>
                            <h3 class="text-2xl font-heading text-red-500 mb-2">Limite de Cl√£s Atingido</h3>
                            <p class="text-gray-300">O mundo j√° possui 4 cl√£s registrados.</p>
                        </div>
                    </div>
                </div>

                <div class="bg-bedrock/50 border border-stone-700 p-8 rounded-lg overflow-hidden relative min-h-[500px]">
                    <h3 class="text-2xl font-heading text-white mb-6 flex items-center gap-2">
                        <span class="material-symbols-outlined">flag</span> Cl√£s Registrados
                        <span id="clan-count" class="text-sm text-gray-400 ml-auto font-body">(0/4)</span>
                    </h3>
                    <div id="clan-list" class="space-y-6 overflow-y-auto max-h-[600px] pr-2">
                        <div class="text-center text-gray-500 mt-20 italic" id="empty-state">
                            Nenhum cl√£ registrado ainda.<br>Seja o primeiro a marcar territ√≥rio.
                        </div>
                    </div>
                    
                    <div class="mt-4 pt-4 border-t border-white/5 text-center">
                         <p class="text-[10px] text-gray-600 uppercase tracking-widest hover:text-red-500 transition-colors cursor-help" onclick="deleteClanPrompt()">
                            <span class="material-symbols-outlined text-[10px] align-middle">key</span> Admin
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <section id="saga" class="py-20 bg-bedrock relative overflow-hidden fade-in-section">
        <div class="max-w-5xl mx-auto px-4 text-center">
            <h2 class="text-4xl text-white font-heading">V. A Saga dos Deuses</h2>
             <p class="text-gray-400 mt-4">Titans e recompensas aguardam.</p>
        </div>
    </section>

    <footer class="bg-black py-16 border-t border-stone-800 text-center relative overflow-hidden">
        <div class="relative z-10">
            <p class="font-heading text-gold text-lg uppercase tracking-widest mb-2">Assinado</p>
            <p class="font-heading text-white text-2xl font-bold mb-8">Tebas & O Supremo Tribunal dos Quatro</p>
        </div>
    </footer>

    <audio id="bg-music" loop><source src="tema.mp3" type="audio/mpeg"></audio>
    <div id="music-controls" class="fixed bottom-6 left-6 z-50 flex items-center gap-3 transition-all duration-500 opacity-50 hover:opacity-100">
        <button onclick="toggleMusic()" class="w-12 h-12 rounded-full bg-black/80 border-2 border-gold text-gold flex items-center justify-center shadow-[0_0_15px_rgba(255,215,0,0.3)] hover:scale-110 hover:bg-gold hover:text-black transition-all group">
            <span id="music-icon" class="material-symbols-outlined animate-pulse-slow">music_off</span>
        </button>
    </div>

    <script>
        // --- CONFIGURA√á√ÉO SUPABASE E ESTADO ---
        const supabaseUrl = 'https://tvaujvgnwpmuybnysmib.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR2YXVqdmdud3BtdXlibnlzbWliIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0NjUwNDAsImV4cCI6MjA4MDA0MTA0MH0.d01sDTQ7LDHfzGgMq9CzrzUkg9pIv0Wa49PK_3geHhk';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        const state = {
            registeredClans: [],
            takenEconomies: new Set(),
            takenColors: new Set(),
            CLAN_LIMIT: 4,
            MEMBER_LIMIT: 6,
            participants: []
        };

        const clanThemes = {
            "LEGADO": { symbol: "Œ©", desc: "\"Nascidos no fogo.\" A imortalidade √© conquistada pela espada.", leader: "ARCONTE", coleader: "EXECUTOR", member: "ESPARTANOS" },
            "ONISCI√äNCIA": { symbol: "‚ò•", desc: "\"Os olhos que veem al√©m.\" Guiados pela certeza divina.", leader: "OR√ÅCULO", coleader: "ARAUTO", member: "ASCENDENTES" },
            "IMP√âRIO": { symbol: "‚ôõ", desc: "\"A ordem pelo ferro.\" Onde a √°guia pousa, o joelho se dobra.", leader: "IMPERADOR", coleader: "LEGATUS", member: "PRETORIANOS" },
            "MILITAR": { symbol: "‚öî", desc: "\"A tempestade de a√ßo.\" Apenas estrat√©gia e for√ßa bruta.", leader: "SOBERANO", coleader: "MARECHAL", member: "VANGUARDA" },
            "MAJESTADE": { symbol: "‚öì", desc: "\"O sol nunca se p√µe.\" Expans√£o √© a √∫nica lei.", leader: "IMPERADOR", coleader: "ALMIRANTE", member: "CAVALEIROS" },
            "OCULTO": { symbol: "‚òæ", desc: "\"O poder consome.\" Aliados das sombras antigas.", leader: "PRIMORDIAL", coleader: "PROFETA", member: "AC√ìLITOS" },
            "DOUTRINA": { symbol: "‚Ä†", desc: "\"Uma f√©. Uma verdade.\" Lealdade absoluta ao prop√≥sito.", leader: "MESTRE", coleader: "AP√ìSTOLO", member: "DISC√çPULOS" },
            "JUSTI√áA": { symbol: "‚öñ", desc: "\"A lei √© a √¢ncora.\" A balan√ßa que julga e a espada que executa.", leader: "TETRARCA", coleader: "JUSTI√áAR", member: "PATRICIANOS" },
            "NOBREZA": { symbol: "‚öú", desc: "\"Sangue azul.\" Poder, ouro e influ√™ncia governam tudo.", leader: "DUQUE", coleader: "CHANCELER", member: "MARQU√äSES" },
            "HONRA": { symbol: "‚ùÄ", desc: "\"A morte √© leve.\" Perfei√ß√£o marcial e paz interior.", leader: "SHOGUN", coleader: "TAISHO", member: "KENSEI" },
            "SOBERANIA": { symbol: "‚ôö", desc: "\"Nossa terra.\" O juramento feudal √© inquebr√°vel.", leader: "MONARCA", coleader: "LORDE", member: "BAR√ïES" },
            "PIRATA": { symbol: "‚ò†", desc: "\"Parte do navio.\" Voc√™s emergem das √°guas.", leader: "LORDE PIRATA", coleader: "IMEDIATO", member: "SAQUEADORES" },
            "LAS NOCHES": { symbol: "üåí", desc: "\"Governem o vazio.\" Quebrem as barreiras da exist√™ncia.", leader: "TRANSCENDENTAL", coleader: "GOVERNANTE", member: "ESPADAS" }
        };

        const glassColors = [
            {name: 'Branco', hex: '#FFFFFF'}, {name: 'Vermelho', hex: '#B02E26'}, {name: 'Laranja', hex: '#F9801D'}, 
            {name: 'Rosa', hex: '#F38BAA'}, {name: 'Amarelo', hex: '#FED83D'}, {name: 'Verde Lima', hex: '#80C71F'},
            {name: 'Verde', hex: '#5E7C16'}, {name: 'Ciano', hex: '#169C9C'}, {name: 'Azul Claro', hex: '#6699d8'},
            {name: 'Azul', hex: '#3C44AA'}, {name: 'Roxo', hex: '#7f3fb2'}, {name: 'Magenta', hex: '#C74EBD'}, 
            {name: 'Marrom', hex: '#835432'}, {name: 'Cinza', hex: '#474F52'}, {name: 'Preto', hex: '#1D1D21'}
        ];

        // --- FUN√á√ïES DE √ÅUDIO ---
        const audio = document.getElementById('bg-music');
        let isPlaying = false;
        audio.volume = 0.4;
        function toggleMusic() {
            if (isPlaying) { audio.pause(); isPlaying = false; document.getElementById('music-icon').innerText = 'music_off'; }
            else { audio.play().then(() => { isPlaying = true; document.getElementById('music-icon').innerText = 'music_note'; }); }
        }
        document.body.addEventListener('click', () => { if(!isPlaying) toggleMusic(); }, {once:true});

        // --- FUN√á√ïES DE UPLOAD & BANNER ---
        async function uploadBannerImage(file) {
            const fileExt = file.name.split('.').pop();
            const fileName = `banner_${Date.now()}.${fileExt}`;
            const { error } = await supabase.storage.from('clan-banners').upload(fileName, file);
            if (error) throw error;
            const { data } = supabase.storage.from('clan-banners').getPublicUrl(fileName);
            return data.publicUrl;
        }

        function previewBanner(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('banner-preview-img').src = e.target.result;
                    document.getElementById('banner-preview-img').classList.remove('hidden');
                    document.getElementById('banner-preview-area').classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        // --- FUN√á√ïES DE CL√ÉS ---
        async function fetchClans() {
            const { data } = await supabase.from('clans').select('*').order('created_at', { ascending: true });
            state.registeredClans = []; state.takenEconomies.clear(); state.takenColors.clear();
            document.getElementById('clan-list').innerHTML = '';
            
            if (data && data.length > 0) {
                data.forEach(c => {
                    state.registeredClans.push(c);
                    state.takenEconomies.add(c.economy_type);
                    state.takenColors.add(c.color);
                    updateClanListUi(c.name, c.motto, c.color, c.theme, c.leader, c.coleader, c.members, c.economy, c.id, c.banner_url);
                    updateEconomyUi(c.economy_type);
                });
            } else {
                 document.getElementById('clan-list').innerHTML = `<div class="text-center text-gray-500 mt-20 italic">Nenhum cl√£ registrado ainda.<br>Seja o primeiro a marcar territ√≥rio.</div>`;
            }
            renderGlassPicker(); 
            renderEconomyGrid();
            updateClanCountUi();
            
            if(state.registeredClans.length >= 4) {
                document.getElementById('limit-reached-msg').classList.remove('hidden');
                document.getElementById('register-btn').disabled = true;
            }
        }

        async function registerClan() {
            const name = document.getElementById('clan-name').value;
            const motto = document.getElementById('clan-motto').value;
            const color = document.getElementById('clan-color').value;
            const theme = document.getElementById('clan-theme').value;
            const leader = document.getElementById('clan-leader').value;
            const coleader = document.getElementById('clan-coleader').value;
            const members = document.getElementById('clan-members').value;
            const economy = document.getElementById('clan-economy-input').value;
            const economyType = document.getElementById('clan-economy-type').value;
            const bannerFile = document.getElementById('clan-banner-file').files[0];
            
            if(state.registeredClans.length >= state.CLAN_LIMIT) return alert("Limite atingido.");
            if(!theme || !economyType || state.takenColors.has(color)) return alert("Dados inv√°lidos ou j√° escolhidos.");

            const btn = document.getElementById('register-btn');
            btn.disabled = true;
            btn.innerText = "Enviando...";
            
            try {
                let bannerUrl = null;
                if(bannerFile) bannerUrl = await uploadBannerImage(bannerFile);
                
                const { error } = await supabase.from('clans').insert([{
                    name, motto, color, theme, leader, coleader, members, 
                    economy, economy_type: economyType, banner_url: bannerUrl
                }]);
                if(error) throw error;
                
                alert("Cl√£ Registrado com Sucesso!");
                fetchClans();
                document.getElementById('clan-form').reset();
                document.getElementById('banner-preview-img').classList.add('hidden');
                document.getElementById('banner-preview-area').classList.remove('hidden');
                document.getElementById('theme-info').classList.add('hidden');
            } catch(e) { alert("Erro: " + e.message); }
            
            btn.disabled = false;
            btn.innerText = "Registrar Cl√£";
        }

        function updateClanListUi(name, motto, color, themeKey, leader, coleader, membersStr, economyName, id, bannerUrl) {
            const theme = clanThemes[themeKey] || { symbol: '?', leader: 'L√≠der' };
            const list = document.getElementById('clan-list');
            const div = document.createElement('div');
            
            // L√≥gica do Banner como Background
            let bgStyle = bannerUrl 
                ? `background: linear-gradient(to top, #1a1a1a 10%, transparent 100%), url('${bannerUrl}'); background-size: cover; background-position: center;` 
                : 'background-color: #292524;';

            div.className = "bg-obsidian border border-stone-700 rounded-lg overflow-hidden group mb-4 relative shadow-lg transition-transform hover:-translate-y-1";
            div.style.borderColor = color;

            div.innerHTML = `
                <div class="h-32 w-full bg-stone-800 relative" style="${bgStyle}">
                    <div class="absolute bottom-2 left-4 text-white drop-shadow-md flex items-center gap-2">
                        <span class="text-3xl">${theme.symbol}</span>
                        <span class="font-heading font-bold text-lg" style="text-shadow: 0 0 5px ${color}">${name}</span>
                    </div>
                </div>
                <div class="p-4 relative">
                    <p class="text-xs text-gray-400 italic mb-3 border-l-2 pl-2" style="border-color: ${color}">"${motto}"</p>
                    <div class="space-y-1 text-sm text-gray-300 border-t border-stone-700 pt-2">
                        <div class="flex justify-between">
                            <span class="text-gray-500">${theme.leader}</span>
                            <span class="font-bold text-white">${leader}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Economia</span>
                            <span class="text-gold">${economyName}</span>
                        </div>
                    </div>
                </div>
            `;
            list.prepend(div);
        }

        async function deleteClanPrompt() {
            const id = prompt("ID do Cl√£ para deletar:");
            if(id && prompt("Senha:") === "TEBAS") {
                await supabase.from('clans').delete().eq('id', id);
                fetchClans();
            }
        }

        // --- UI HELPERS ---
        function renderGlassPicker() {
            const picker = document.getElementById('glass-picker');
            if(!picker) return;
            picker.innerHTML = glassColors.map(gc => {
                const taken = state.takenColors.has(gc.hex);
                return `<div class="glass-option ${taken ? 'disabled' : ''}" style="background-color: ${gc.hex};" onclick="${taken ? '' : `selectColor('${gc.hex}', '${gc.name}', this)`}" title="${gc.name}"></div>`;
            }).join('');
        }
        function selectColor(hex, name, el) {
            document.querySelectorAll('.glass-option').forEach(d => d.classList.remove('selected'));
            el.classList.add('selected');
            document.getElementById('clan-color').value = hex;
            document.getElementById('selected-color-name').innerText = `Selecionado: ${name}`;
        }
        function renderEconomyGrid() {
             const grid = document.getElementById('economy-grid');
             if(!grid) return;
             // Limpa antes de renderizar para n√£o duplicar se rodar 2x
             grid.innerHTML = ''; 
             const opts = [
                 {id:'iron', name:'Caminho do A√ßo', desc:'Ferro Infinito', icon:'shield', img:'img/farm-de-ferro.jpg', type:'Ferro'},
                 {id:'gold', name:'Caminho da Riqueza', desc:'Ouro Infinito', icon:'payments', img:'img/farm-de-ouro.jpg', type:'Ouro'},
                 {id:'raid', name:'Caminho da Vida', desc:'Totens Infinitos', icon:'local_fire_department', img:'img/raid-farm.jpg', type:'Raid'},
                 {id:'xp', name:'Caminho do Encanto', desc:'XP Massivo', icon:'bolt', img:'img/farm-de-xp.jpg', type:'XP'}
             ];
             grid.innerHTML = opts.map(o => {
                const taken = state.takenEconomies.has(o.type);
                return `<div id="opt-${o.id}" class="bg-obsidian border border-stone-600 p-6 rounded-lg cursor-pointer relative overflow-hidden group h-full ${taken ? 'farm-taken' : ''}" onclick="selectFarm('${o.id}')"><div class="absolute inset-0 z-0"><img src="${o.img}" class="w-full h-full object-cover opacity-30 group-hover:opacity-50 transition-opacity"></div><div class="relative z-10 text-center"><span class="material-symbols-outlined text-5xl mb-2 text-white">${o.icon}</span><h4 class="text-xl font-heading text-white group-hover:text-gold">${o.name}</h4><p class="text-xs text-gray-400 uppercase">${o.desc}</p></div></div>`}).join('');
        }
        function selectFarm(id) {
            const maps = { 'iron': {name: 'Caminho do A√ßo', type: 'Ferro'}, 'gold': {name: 'Caminho da Riqueza', type: 'Ouro'}, 'raid': {name: 'Caminho da Vida', type: 'Raid'}, 'xp': {name: 'Caminho do Encanto', type: 'XP'} };
            const type = maps[id].type;
            if(state.takenEconomies.has(type)) return;
            document.getElementById('clan-economy-input').value = maps[id].name;
            document.getElementById('clan-economy-type').value = maps[id].type;
            document.getElementById('registro').scrollIntoView({ behavior: 'smooth' });
        }
        function updateEconomyUi(type) { 
             const map = {'Ferro':'opt-iron', 'Ouro':'opt-gold', 'Raid':'opt-raid', 'XP':'opt-xp'};
             const el = document.getElementById(map[type]);
             if(el) { el.classList.add('farm-taken'); el.onclick = null; }
        }
        function updateThemeInfo() {
            const themeKey = document.getElementById('clan-theme').value;
            const theme = clanThemes[themeKey];
            const infoBox = document.getElementById('theme-info');
            if(theme) {
                infoBox.classList.remove('hidden');
                document.getElementById('theme-desc').innerText = theme.desc;
                document.getElementById('theme-leader-title').innerText = theme.leader;
                document.getElementById('theme-coleader-title').innerText = theme.coleader;
                document.getElementById('theme-member-title').innerText = theme.member;
                document.getElementById('label-leader').innerText = `${theme.leader} (Nick):`;
                document.getElementById('label-coleader').innerText = `${theme.coleader} (Nick):`;
            }
        }
        function validateMembers() {
            const input = document.getElementById('clan-members');
            const feedback = document.getElementById('member-count-feedback');
            const count = input.value.split(',').filter(m => m.trim() !== '').length;
            feedback.innerText = `${count}/${state.MEMBER_LIMIT} Membros`;
            if (count > state.MEMBER_LIMIT) { input.classList.add('error'); return false; } 
            input.classList.remove('error'); return true;
        }
        function updateClanCountUi() { document.getElementById('clan-count').innerText = `(${state.registeredClans.length}/${state.CLAN_LIMIT})`; }
        function copyColorCode() { 
            navigator.clipboard.writeText(document.getElementById('clan-color').value); 
            const fb = document.getElementById('copy-feedback');
            fb.classList.remove('opacity-0'); 
            setTimeout(() => fb.classList.add('opacity-0'), 2000); 
        }

        // --- INICIALIZA√á√ÉO ---
        document.addEventListener('DOMContentLoaded', () => {
            fetchParticipants();
            fetchClans();
            
            const themeSelect = document.getElementById('clan-theme');
            if(themeSelect) {
                Object.keys(clanThemes).forEach(key => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.text = `${clanThemes[key].symbol} ${key}`;
                    themeSelect.appendChild(option);
                });
            }

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => { if(entry.isIntersecting) entry.target.classList.add('is-visible'); });
            });
            document.querySelectorAll('.fade-in-section').forEach(s => observer.observe(s));
            
            const startDate = new Date('2025-12-15T18:00:00');
            const diff = new Date() - startDate;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            document.getElementById('server-days').innerText = days > 0 ? days : 0;
        });

        // Fun√ß√£o de Participantes
        async function fetchParticipants() {
            const { data, error } = await supabase.from('participants').select('nickname');
            if(!error) {
                state.participants = data.map(p => p.nickname);
                document.getElementById('participant-count').innerText = state.participants.length;
            }
        }
        async function confirmParticipation() {
             // (L√≥gica de join mantida simples, adicione se precisar da fun√ß√£o completa)
             alert("Fun√ß√£o de Join est√° ativa no banco de dados.");
             closeJoinModal();
        }
        function closeJoinModal() { document.getElementById('join-modal').classList.add('hidden'); }
    </script>
</body>
</html>
